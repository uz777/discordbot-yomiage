## 機能説明
ここでは、yomiageの主な機能について説明します。  
具体的なコマンドの用法については、yomiageのインストール後に、ヘルプコマンドを使用して確認してください。

1. [読み上げ](#読み上げ)
1. [設定](#設定)
1. [設定状態取得](#設定状態取得)
1. [動作状態取得](#動作状態取得)
1. [バージョン情報取得](#バージョン情報取得)
1. [設定ファイル指定起動](#設定ファイル指定起動)
1. [バイナリディストリビューション](#バイナリディストリビューション)

### 読み上げ
yomiageの名の示す通り、このボットの主機能です。  
指定されたテキストチャンネルに対する投稿を、指定されたボイスチャンネルで読み上げます。  
読み上げには[Open JTalk](https://ja.wikipedia.org/wiki/Open_JTalk)を使用し、HTS VoiseとしてOSSで配布されている以下の声質を選択することができます。
- HTS Voice "Mei" normal, happy, angry, sad, bashful (5種)
- HTS Voice "Takumi" normal, happy, angry, sad (4種)
- NIT ATR503 M001 1種

読み上げが長時間ブロックされることを防ぐため、yomiageは以下の順で、読み上げるテキストの加工を行います。
1. 2行目以降の内容を削除
2. メンション(@ユーザー)の削除
3. URLを「ゆーあーるえる」に置換
4. 5桁以上の数字を「たくさん」に置換
5. 上記すべての処理を行っても20字を超える場合は、20字よりも後ろを切り捨て

読み上げ中に次の投稿を受信すると、yomiageはサーバーごとのキュー（再生待ち行列）の中にテキストをスタックし、受け取った順番で再生を行います。

### 設定
yomiageは、いくつかの設定を行って動作をカスタマイズすることができます。

ここでは、設定可能な項目を列挙して解説します。  
具体的にどう設定を行うべきかは、`config.yml`内のコメント、および`help`コマンドが役に立ちます。  
設定のいくつかは、階層的な設定が可能です。ルート設定＜サーバー個別設定＜ユーザー個別設定の順で、より右の設定があればそれが採用されます。  
ルート設定は設定ファイルで、サーバー個別設定はサーバー管理者によるコマンド操作で、ユーザー個別設定はユーザーのコマンドで設定します。  

デフォルトの設定で良い場合には、ほぼ編集の必要はないので安心してください。  
編集が必要なのはボットトークンのみです。ボットトークンが設定されていないと、ボットを起動することができません。

◎：変更必須　〇：変更可　―：変更不可

|  設定項目  |  説明  |  ルート設定<br>(設定ファイル)  |  サーバー個別設定<br>(管理者コマンド)  |  ユーザー個別設定<br>(ユーザーコマンド)  |
| ---- | ---- | :----: | :----: | :----: |
|  ボットトークン  |  Discordがあなたのボットを識別・認証するためのトークンです。  |  ◎  |  ―  |  ―  |
|  コマンドプレフィックス  |  Discordがこのボット向けのコマンドを認識するための記号です。<br>例えば+を設定すると、helpコマンドは実際には+helpとして呼び出すことになります。<br>サーバーの管理ユーザーは、`s_prefix`コマンドにより、サーバーごとに個別のプレフィックスを設定することもできます。  |  〇  |  〇  |  ―  |
|  声質  |  読み上げを行う際の声質です。<br>サーバーの管理ユーザーは、`s_voice`コマンドにより、サーバーごとに個別の声質設定を行うことができます。<br>更に、各ユーザーは`voice`コマンドにより、自分の投稿が読み上げられる際の声質を設定することができます。  |  〇  |  〇  |  〇  |
|  色  |  ボットがメッセージを表示する際の色を設定できます。エラー時、警告時、成功時の3色です。<br>色の設定は設定ファイルでのみ変更できます。 |  〇  |  ―  |  ―  |
|  メッセージ  |  ボットが表示するメッセージです。メッセージ内容は設定ファイルでのみ変更できます。 <br>メッセージ中、`{cmd_prefix}`のように波カッコで囲われた箇所は、実行時には具体的な値に置き換えられます。  |  〇  |  ―  |  ―  |
|  ログ出力  |  ログ出力設定です。<br>変更することで自由にログフォーマットや出力方法を変更することができますが、ここでは解説しません。<br>デフォルトでは、INFOレベル以上のログがコンソールに、ERRORレベル以上のログは`yomiage.log`という名称のファイルに出力されます。  |  〇  |  ―  |  ―  |

### 設定状態取得
コマンド実行により、実行中のボットのサーバー個別設定、およびユーザー個別設定をボットに返信させることができます。

### 動作状態取得
コマンド実行により、接続中のボイスチャンネル、読み上げ中のテキストチャンネルなどの動作状態をボットに返信させることができます。

### バージョン情報取得
コマンド実行により、yomiageのバージョンをボットに返信させることができます。

### 設定ファイル指定起動
yomiageは、特に引数を与えずに起動した場合、カレントディレクトリ直下のconfig.ymlを設定ファイルとして読み込みます。  
yomiageに引数を与えて起動(コマンドラインから起動)すると、yomiageは第一引数を設定ファイルのパスとして解釈します。これにより、単一のスクリプト(または実行ファイル)から、複数のボットインスタンスを起動することが可能となります。  
Discordの仕組み上、ボットは(サーバー内では)1つのボイスチャンネルにしか参加できません。従って、複数のボイスチャンネルでボットを使用する場合には、必然的に複数のボットインスタンスを用意することになります。この機能は、複数のボットインスタンスを実行する際に有用です。  
もちろん、スクリプト(または実行ファイル)を起動したいインスタンスの数だけ用意しても構いません。
コマンドラインや引数という単語を聞いてもピンとこない場合は、後者の手段をとる方がよいでしょう。

### バイナリディストリビューション
これは厳密には機能ではありませんが、yomiageの大きな特色であるため、記載します。  
yomiageはpython3.10を使用して製造されています。このリポジトリをgit cloneし、pipで依存ライブラリをインストールすることでも実行できますが、このリポジトリからは、単一のバイナリ(.exe)で構成されたディストリビューションを入手することもできます。  
このバイナリは、pyinstallerの使用により、pythonランタイム、およびその他すべての依存モジュールが1ファイルにパッケージされたものです。パッケージングによって、ユーザーは面倒な準備作業のほとんどをスキップし、設定ファイルを書いてexeを起動するだけでボットを使うことができます。  
音声合成に関連するサイズの大きな依存ソフトウェアが同梱されるため、パッケージのサイズは非常に大きく(100MB弱)となっています。
